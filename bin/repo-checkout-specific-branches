#!/usr/bin/env bash

set -eu -o pipefail

# THIS IS REALLY A UGLY HACK - DO NOT USE IT IN PRODUCTION - ITS JUST A SHOWCASE
declare -A branches
#branches["sisu/sisu-project"]="main"
# Specific branches
branches["sources"]="${BRANCH}-with-site"
branches["plugins/core/maven-verifier-plugin"]="${BRANCH}"
branches["plugins/tools/maven-stage-plugin"]="${BRANCH}"
branches["shared/artifact-transfer"]="${BRANCH}"
branches["shared/mapping"]="${BRANCH}"
branches["shared/project-utils"]="${BRANCH}"
branches["shared/shared-io"]="${BRANCH}"
branches["studies/consumer-pom"]="${BRANCH}-consumer-pom"
branches["studies/maven-eventsound-extension"]="${BRANCH}-maven-eventsound-extension"
branches["studies/maven-extension-demo"]="${BRANCH}-maven-extension-demo"

# Use latest repo if available
PATH=".repo/repo:${PATH}"

for branch in "${!branches[@]}"; do
  origin="sac"
  case "${branch}" in
    sisu/*)
      origin="sisu"
      ;;
    plexus/*)
      origin="plexus"
      ;;
  esac
  repo forall -v "${branch}" -c "git fetch --all --prune && git checkout -b ${branches[${branch}]} ${origin}/${branches[${branch}]} || true"
done